# Расширения JSON схемы событий

## Новые возможности в choices

### Поля cost и benefit

Добавлены поля для указания стоимости и выгоды от выбора:

```json
{
  "label": "Поесть и отдохнуть (-3 золота, +HP)",
  "next": "auto",
  "cost": {
    "gold": 3,
    "items": ["ration"]
  },
  "benefit": {
    "hp": "+8",
    "items": ["well_rested_bonus"]
  }
}
```

## Динамические эффекты

### Строковые значения в effects

Поддерживаются динамические эффекты через строковые значения:

```json
{
  "effects": {
    "hp": "+8",           // Фиксированное изменение
    "gold": "random:-5,+15",  // Случайное от -5 до +15
    "fame": "chance:0.5,+2,-1" // 50% шанс +2, иначе -1
  }
}
```

### Типы динамических эффектов

1. **Фиксированные**: `"+8"`, `"-4"`
2. **Случайные диапазоны**: `"random:-8,+5"`
3. **Вероятностные**: `"chance:0.5,+6,-3"`

## Новые значения next

### goto_location

Переходы между локациями:

```json
{
  "label": "В деревню",
  "next": "goto_location:village"
}
```

## Пример полного события с расширениями

```json
{
  "id": "village.tavern.gambling",
  "type": "village",
  "title": "Азартные игры",
  "text": "За столом идёт игра в кости...",
  "choices": [
    {
      "label": "Поставить 3 золота",
      "next": "auto",
      "cost": { "gold": 3 },
      "benefit": { "thrill": "+1" }
    }
  ],
  "effects": {
    "gold": "chance:0.5,+6,-3"  // 50% удвоить ставку или потерять
  },
  "rules": {
    "chance": 0.3,
    "only_in_location": "village"
  },
  "tags": ["gambling", "risk"],
  "version": 1
}
```

## Обратная совместимость

Все старые события остаются рабочими. Новые поля опциональны:

- `cost` и `benefit` в choices - опциональны
- Строковые effects работают наряду с числовыми
- Новые значения next дополняют существующие

## Валидация API

API автоматически обрабатывает:

1. ✅ Динамические эффекты
2. ✅ Переходы goto_location
3. ✅ Стоимость и выгоду выборов
4. ✅ Обратную совместимость

---

*Обновлено: 2024-10-25*  
*Версия расширений: 1.1*
