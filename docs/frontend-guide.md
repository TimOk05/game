# Frontend Guide - Simple SPA Game

## Архитектура

Игра построена как простой SPA (Single Page Application) на чистом JavaScript без фреймворков.

### Структура файлов

```
/public/
├── index.html     # Основная HTML структура
├── app.css        # Стили с адаптивным дизайном
├── app.js         # Игровая логика и API интеграция
└── .htaccess      # Конфигурация для SPA маршрутизации
```

## Компоненты интерфейса

### 1. Панель статистик
- **HP** (здоровье) - цветовая индикация состояния
- **DMG** (урон) - боевая характеристика  
- **Fame** (слава) - репутация игрока
- **Gold** (золото) - игровая валюта
- **Location** - текущая локация
- **Turn** - номер хода

### 2. Инвентарь
- Список предметов игрока
- Автоматическое обновление при получении/потере предметов
- Показ "Пусто" если предметов нет

### 3. Карточка события
- **Изображение** - визуальное представление события
- **Заголовок** - "Событие: {title}"
- **Текст** - описание ситуации
- **Кнопки выборов** - интерактивные действия с cost/benefit информацией

### 4. Специальные экраны
- **Экран смерти** - при HP ≤ 0
- **Экран загрузки** - во время API запросов
- **Экран завершения** - при окончании игры

## Игровая логика

### Состояние игрока (localStorage)

```javascript
state = {
    location: "main",        // Текущая локация
    turn: 0,                // Номер хода
    seenIds: [],            // Просмотренные события
    cooldowns: {},          // Кулдауны событий
    stats: {
        hp: 20,             // Здоровье
        damage: 3,          // Урон
        fame: 0,            // Слава
        gold: 10,           // Золото
        items: []           // Инвентарь
    }
}
```

### Обработка эффектов

Игра поддерживает различные типы эффектов:

```javascript
// Простые числовые значения
"hp": 10        // +10 HP

// Строковые модификаторы
"hp": "+8"      // +8 HP
"gold": "-5"    // -5 золота

// Случайные значения
"gold": "random:-5,+15"    // От -5 до +15 золота

// Вероятностные эффекты  
"fame": "chance:0.5,+2,-1" // 50% шанс +2, иначе -1
```

### Обработка выборов

1. **Проверка ресурсов** - достаточно ли gold/items для cost
2. **Применение cost/benefit** - немедленные эффекты выбора
3. **Применение эффектов события** - общие эффекты после выбора
4. **Обработка goto_location** - смена локации если нужно
5. **Завершение хода** - turn++, обновление cooldowns, seenIds
6. **Проверка смерти** - показ экрана смерти при HP ≤ 0
7. **Запрос следующего события** - через API

## API Интеграция

### Запрос следующего события

```javascript
POST /api/next.php
{
  "state": {
    "location": "village",
    "turn": 5,
    "seenIds": ["village.gate.001"],
    "cooldowns": {"village.tavern": 2},
    "stats": {"hp": 85, "gold": 15, "fame": 3, "items": []}
  }
}
```

### Ответ API

```javascript
{
  "success": true,
  "data": {
    "event": {
      "id": "village.tavern.gambling",
      "title": "Азартные игры",
      "text": "За столом идёт игра в кости...",
      "choices": [
        {
          "label": "Поставить 3 золота",
          "next": "auto",
          "cost": {"gold": 3}
        }
      ],
      "effects": {
        "gold": "chance:0.5,+6,-3"
      }
    }
  }
}
```

## Стили и адаптивность

### CSS Grid Layout

```css
#app {
  display: grid;
  grid-template-areas: 
    "stats stats"
    "inventory game";
  grid-template-columns: 300px 1fr;
}
```

### Адаптивность

- **Desktop** - сетка со статистиками сверху, инвентарем слева
- **Mobile** - вертикальная компоновка, все элементы в столбец
- **Responsive breakpoints** - 768px и 480px

### Анимации

- **Hover эффекты** на кнопках с градиентами
- **Переходы** при наведении и нажатии
- **Спиннер загрузки** с CSS animation
- **Плавные цветовые переходы** для статистик

## Функции безопасности

### Валидация входных данных

```javascript
normalizeEffect(value) {
  // Проверка типов и форматов
  // Защита от некорректных значений
  // Обработка edge cases
}
```

### Проверка ресурсов

```javascript
applyCostBenefit(cost, benefit) {
  // Проверка достаточности ресурсов
  // Атомарное применение изменений
  // Откат при ошибках
}
```

### Сохранение состояния

```javascript
saveState() {
  try {
    localStorage.setItem('gameState', JSON.stringify(this.state));
  } catch (e) {
    console.error('Failed to save state:', e);
  }
}
```

## Отладка и тестирование

### Консольные команды

```javascript
// Доступ к игровому движку
game.state                    // Текущее состояние
game.resetState()            // Сброс игры
game.state.stats.hp = 100    // Изменение статистик
game.saveState()             // Принудительное сохранение
```

### Проверка API

```javascript
// Тестирование API запросов
fetch('/api/test.php')       // Диагностика системы
fetch('/api/list.php?type=village')  // Список событий
```

## Развертывание

1. Убедитесь что файлы в `/public/` доступны веб-серверу
2. Проверьте работу `.htaccess` для SPA маршрутизации  
3. Убедитесь что API endpoints (`/api/*.php`) работают
4. Откройте игру в браузере и проверьте консоль на ошибки

## Возможности расширения

- **Звуковые эффекты** - добавление audio для событий
- **Анимации переходов** - между событиями и локациями
- **Сохранение в облаке** - синхронизация между устройствами
- **Мультиплеер** - WebSocket интеграция
- **Модульность** - разбиение на компоненты
- **PWA** - офлайн режим и установка как приложение

---

*Версия: 2.0*  
*Обновлено: 2024-10-25*
