# Game Project

Полноценная интерактивная игра с системой событий, архитектурой SPA и мощным PHP API.

## Структура проекта

```
/
├── public/                 # Фронтенд приложения
│   ├── index.html         # Главная HTML страница
│   ├── app.css           # Стили приложения  
│   ├── app.js            # JavaScript логика
│   └── .htaccess         # Конфигурация Apache для SPA
├── api/                   # PHP API endpoints
│   ├── list.php          # Получение списка элементов
│   ├── get.php           # Получение конкретного элемента
│   └── next.php          # Получение следующего состояния/события
├── events/               # Данные событий (JSON файлы)
│   ├── main/             # События главной области
│   ├── village/          # События деревни
│   └── shared/           # Общие события
└── README.md             # Документация проекта
```

## Деплой на PHP-хостинге

### Требования

- PHP 7.4 или выше
- Apache веб-сервер с поддержкой mod_rewrite

## Оптимизация ассетов

### Видео файлы
- **Разрешение**: ≤720p (1280x720)
- **Частота кадров**: 24-30fps
- **Кодек**: VP9/AV1/WebM (приоритет) + MP4 H.264 (fallback)
- **Размер**: рекомендуется ≤5MB для быстрой загрузки

### Аудио файлы
- **Формат**: MP3/OGG
- **Битрейт**: 128-160kbps
- **Размер**: рекомендуется ≤2MB для фоновой музыки

### Изображения
- **Разрешение**: ширина ≤1280px (достаточно для мобильных)
- **Формат**: WebP (приоритет) + JPG (fallback)
- **Сжатие**: оптимизированное для веба
- **Ленивая загрузка**: `loading="lazy"` уже настроена
- Доступ к загрузке файлов через FTP/файловый менеджер

### Пошаговая инструкция

#### 1. Подготовка файлов

Скачайте или скопируйте все файлы проекта на свой локальный компьютер.

#### 2. Загрузка на хостинг

1. Подключитесь к своему хостингу через FTP-клиент (FileZilla, WinSCP) или используйте файловый менеджер в панели управления хостингом
2. Загрузите всю структуру проекта в корневую папку сайта (обычно `public_html`, `www` или `htdocs`)

#### 3. Настройка .htaccess

Файл `.htaccess` уже создан в папке `/public`. Он настроен для:
- Перенаправления всех запросов (кроме API) на `index.html` для работы SPA
- Исключения папки `/api/` из перенаправлений
- Оптимизации кэширования статических файлов
- Сжатия контента для улучшения производительности

#### 4. Настройка прав доступа

Убедитесь, что у PHP есть права на чтение файлов в папке `/events/`. Обычно права 644 для файлов и 755 для папок подходят.

#### 5. Добавление событий

Создайте JSON файлы с событиями в соответствующих папках:

**Пример файла события (`events/main/start.json`):**
```json
{
    "id": "start",
    "title": "Начало приключения",
    "description": "Вы стоите на краю неизвестного мира...",
    "choices": [
        {
            "id": "go_forest",
            "text": "Идти в лес",
            "next": "forest_entrance"
        },
        {
            "id": "go_village", 
            "text": "Идти в деревню",
            "next": "village_gate"
        }
    ]
}
```

### Проверка работы

1. Откройте ваш сайт в браузере
2. Убедитесь, что главная страница загружается
3. Проверьте работу API endpoints:
   - `http://yoursite.com/api/list.php?type=village` - список событий
   - `http://yoursite.com/api/get.php?id=village.tavern` - конкретное событие
   - `http://yoursite.com/api/test.php` - диагностика системы

### Возможные проблемы и решения

#### 1. Ошибка 500 (Internal Server Error)

- Проверьте права доступа к файлам
- Убедитесь, что mod_rewrite включен на хостинге
- Проверьте логи ошибок хостинга

#### 2. API не работает

- Убедитесь, что PHP включен на хостинге
- Проверьте версию PHP (должна быть 7.4+)
- Убедитесь, что папка `/api/` доступна для выполнения PHP скриптов

#### 3. SPA навигация не работает

- Проверьте, что файл `.htaccess` загружен в папку `/public/`
- Убедитесь, что mod_rewrite включен на сервере
- Проверьте настройки хостинга для работы с .htaccess файлами

#### 4. Не загружаются события

- Проверьте, что папка `/events/` и подпапки существуют
- Убедитесь, что JSON файлы имеют корректный синтаксис
- Проверьте права доступа к папке с событиями

### Разработка и тестирование

Для локальной разработки вы можете использовать:

- XAMPP, WAMP, или MAMP для создания локального PHP сервера
- Live Server (VS Code расширение) для фронтенда
- Любой локальный веб-сервер с поддержкой PHP

### Новые особенности

#### Интеллектуальная система событий
- **Приоритетные события**: по частоте (каждые N ходов)
- **Кулдауны**: предотвращение спама событий
- **Одноразовые события**: сюжетные моменты
- **Случайные дочерние события**: child_roll механика

#### Динамические эффекты
```json
{
  "effects": {
    "hp": "+8",
    "gold": "random:-5,+15",
    "fame": "chance:0.5,+2,-1"
  }
}
```

#### Кэширование и оптимизация
- Автоматическая индексация событий
- In-memory кэш для быстрого поиска
- Оптимизированная фильтрация

### Структура API

#### GET /api/list.php
Параметры:
- `type` (опционально) - фильтр по типу (`village`, `main`, `shared`)

#### GET /api/get.php
Параметры:
- `id` - ID события (например: `village.tavern`)

#### POST /api/next.php
Тело запроса (JSON):
```json
{
  "state": {
    "location": "village",
    "turn": 5,
    "seenIds": ["village.gate.001"],
    "cooldowns": {"village.tavern": 2},
    "stats": {
      "hp": 85, "gold": 15, "fame": 3, "items": []
    }
  }
}
```

#### GET /api/test.php
Диагностика системы - показывает статистику событий и тестирует логику

### Документация

- `docs/event-schema.md` - полное описание JSON схемы событий
- `docs/event-schema-extensions.md` - расширения схемы
- `docs/quick-start.md` - краткое руководство
- `docs/api-usage.md` - полная документация API

### Примеры событий

Проект включает полный набор примеров:
- **Пролог** - линейная сюжетная линия
- **Деревня** - сложные события с случайными исходами
- **Общие** - универсальные события для всех локаций

### Лицензия

Этот проект создан для образовательных целей. Используйте свободно.

---

*Обновлено: 2024-10-25*  
*Версия: 2.0 - Полная система событий*
